/* CAMBIOS PARA LLENADO DE PERFIL */
-- LOCAL:      OK
-- PRUEBAS:    PENDIENTE
-- PRODUCCIÓN: PENDIENTE

-- BUSCAR CONSTTRAINT
ALTER TABLE TR_RESPUESTA_USUARIO_ENCUESTA
    DROP CONSTRAINT DF__TR_RESPUE__RESPU__336AA144;

ALTER TABLE TR_RESPUESTA_USUARIO_ENCUESTA
    ALTER COLUMN RESPUESTA_ABIERTA NVARCHAR(500) NULL
;

/* INICIO TABLA PARA COORDINADORES DE TUTORIAS */
CREATE TABLE TR_COORDINADOR_DEPARTAMENTAL_TUTORIA
(
    PK_COORDINADOR          INT      NOT NULL IDENTITY (1,1),
    FK_USUARIO              INT      NOT NULL,
    FK_AREA_ACADEMICA       INT      NOT NULL,

    ESTADO                  SMALLINT NOT NULL DEFAULT 1,

    FK_USUARIO_REGISTRO     INT,
    FECHA_REGISTRO          DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FK_USUARIO_MODIFICACION INT,
    FECHA_MODIFICACION      DATETIME,
    BORRADO                 SMALLINT NOT NULL DEFAULT 0
);

ALTER TABLE TR_COORDINADOR_DEPARTAMENTAL_TUTORIA
    ADD CONSTRAINT PRK_COORDINADOR_TR_COORDINADOR_DEPARTAMENTAL_TUTORIA
        PRIMARY KEY (PK_COORDINADOR ASC);

ALTER TABLE TR_COORDINADOR_DEPARTAMENTAL_TUTORIA
    ADD CONSTRAINT FRK_USUARIO_TR_COORDINADOR_DEPARTAMENTAL_TUTORIA
        FOREIGN KEY (FK_USUARIO) REFERENCES CAT_USUARIO (PK_USUARIO);

ALTER TABLE TR_COORDINADOR_DEPARTAMENTAL_TUTORIA
    ADD CONSTRAINT FRK_DEPARTAMENTO_TR_COORDINADOR_DEPARTAMENTAL_TUTORIA
        FOREIGN KEY (FK_AREA_ACADEMICA) REFERENCES CAT_AREA_ACADEMICA (PK_AREA_ACADEMICA);

/* FIN TABLA PARA COORDINADORES DE TUTORIAS */

/* REGISTRO DE MÓDULO DATOS DE TUTOR PARA ALUMNOS */
INSERT INTO PER_CAT_MODULO(NOMBRE, ESTADO, ORDEN)
VALUES ('Datos tutor', 1, 1);

/* ASIGNACIÓN DE MÓDULO DATOS DE TUTOR PARA ALUMNOS A ROL ESTUDIANTE */
INSERT INTO PER_TR_ROL_MODULO(FK_ROL, FK_MODULO)
VALUES (1, (SELECT PK_MODULO FROM PER_CAT_MODULO WHERE NOMBRE = 'Datos tutor'));

/* REGISTRO DE MÓDULO USUARIOS DE TUTORIAS */
INSERT INTO PER_CAT_MODULO(NOMBRE, ESTADO, ORDEN)
VALUES ('Usuarios', 1, 1);

/* ASIGNACIÓN DE MÓDULO USUARIOS DE TUTORIAS A ROL ADMINISRADOR */
INSERT INTO PER_TR_ROL_MODULO(FK_ROL, FK_MODULO)
VALUES (5, (SELECT PK_MODULO FROM PER_CAT_MODULO WHERE NOMBRE = 'Usuarios'));

/* REGISTRO DE MÓDULO HORARIO ALUMNO DE TUTORIAS */
INSERT INTO PER_CAT_MODULO(NOMBRE, ESTADO, ORDEN)
VALUES ('Horario', 1, 3);

/* ASIGNACIÓN DE MÓDULO HORARIO ALUMNO A ROL ALUMNO */
INSERT INTO PER_TR_ROL_MODULO(FK_ROL, FK_MODULO)
VALUES (1, (SELECT PK_MODULO FROM PER_CAT_MODULO WHERE NOMBRE = 'Horario'));

/* REGISTRO DE MÓDULO SEGUIMIENTO ALUMNO DE TUTORIAS */
INSERT INTO PER_CAT_MODULO(NOMBRE, ESTADO, ORDEN)
VALUES ('Seguimiento académico', 1, 4);

/* ASIGNACIÓN DE MÓDULO SEGUIMIENTO A ROL ALUMNO */
INSERT INTO PER_TR_ROL_MODULO(FK_ROL, FK_MODULO)
VALUES (1, (SELECT PK_MODULO FROM PER_CAT_MODULO WHERE NOMBRE = 'Seguimiento académico'));
